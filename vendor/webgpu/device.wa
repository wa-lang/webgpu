
import "js"

/*
不能使用该类型直接声明值，需通过 CreateDevice() 创建
*/
type Device struct {
    js.ExtObj
}

func Test() {
    println("Test")
}

func CreateDevice() => Device {
    d: Device
    d.ExtObj = js.WrapExtObj(jsCreateDevice())
    return d
}

func Device.CreateShaderModule(code: string) => ShaderModule {
    s: ShaderModule
    s._extref = js.WrapExtObj(jsCreateShaderModule(this.GetHandle(), code))
    return s
}

func Device.CreateBuffer(byteLen: i32, usage: BufferUsage) => Buffer {
    b: Buffer
    b._device = this.ExtObj
    b.ExtObj = js.WrapExtObj(jsCreateBuffer(this.GetHandle(), byteLen, usage))
    return b
}

func Device.CreateRenderPipeline(desc: PipelineDesc) => RenderPipeline {
    p: RenderPipeline
    p.ExtObj = js.WrapExtObj(jsCreateRenderPipeline(this.GetHandle(), desc.GetHandle()))

    return p
}

func Device.CreateCommandEncoder() => CommandEncoder {
    c: CommandEncoder
    c.ExtObj = js.WrapExtObj(jsCreateCommandEncoder(this.GetHandle()))

    return c
}

func Device.Submit(gb: GPUCommandBuffer) {
    jsSubmit(this.GetHandle(), gb.GetHandle())
}